<!DOCTYPE html>
<html lang="">

<head><meta name="generator" content="Hexo 3.8.0">
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1.0, user-scalable=no">

    
      <link rel="icon" href="/note/shell.png">
    

    <title>
        
          kaiiiz/note
        
    </title>

    <!-- Spectre.css framework (v0.5.8) -->
    <link rel="stylesheet" href="https://unpkg.com/spectre.css/dist/spectre.min.css">
    <link rel="stylesheet" href="https://unpkg.com/spectre.css/dist/spectre-exp.min.css">
    <link rel="stylesheet" href="https://unpkg.com/spectre.css/dist/spectre-icons.min.css">

    <!-- Noto Sans TC -->
    <link href="https://fonts.googleapis.com/css?family=Noto+Sans+TC" rel="stylesheet">
    <!-- Noto Sans SC -->
    <link href="https://fonts.googleapis.com/css?family=Noto+Sans+TC" rel="stylesheet">
    <!-- Noto Sans -->
    <link href="https://fonts.googleapis.com/css?family=Noto+Sans" rel="stylesheet">

    <!-- theme css & js -->
    <link rel="stylesheet" href="/note/css/spectre_custom.css">
    <link rel="stylesheet" href="/note/css/book.css">
    <script src="/note/js/book.js"></script>

    <!-- tocbot -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/tocbot/4.4.2/tocbot.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/tocbot/4.4.2/tocbot.css">

    <!-- highlight.js -->
    <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.15.6/styles/default.min.css">
    <script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.15.6/highlight.min.js"></script>
    <script>hljs.initHighlightingOnLoad();</script>
    
    <!-- katex -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.10.0/katex.min.css">

    
<!-- Google Analytics -->
<script>
(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

ga('create', 'UA-112717568-3', 'auto');
ga('send', 'pageview');
</script>
<!-- End Google Analytics -->

</head>

<body>

<div class="container">
  <div class="book-container">
    <div class="columns">
      <div class="column col-2 hide-lg">
        <div class="book-sidebar">
  <h4 class="site-meta">
    <a href="/note/">kaiiiz/note</a>
  </h4>
  <div class="sidebar-content">
    <ul>
<li><a href="/note">首頁</a></li>
<li><a href="/note/1072/sophomore">大二</a>
<ul>
<li><a href="/note/1072/intro-to-formal-language/0-courseinfo">正規語言概論</a>
<ul>
<li><a href="/note/1072/intro-to-formal-language/1-finite-automata">Finite Automata</a></li>
<li><a href="/note/1072/intro-to-formal-language/2-regular-languages">Regular Languages</a></li>
<li><a href="/note/1072/intro-to-formal-language/3-context-free-languages">Context-Free Languages</a></li>
<li><a href="/note/1072/intro-to-formal-language/4-pushdown-automata">Pushdown Automata</a></li>
<li><a href="/note/1072/intro-to-formal-language/5-turing-machines">Turing Machines</a></li>
<li><a href="/note/1072/intro-to-formal-language/6-hierarchy-of-formal-languages">Hierarchy of Formal Languages</a></li>
<li><a href="/note/1072/intro-to-formal-language/7-limits-of-computation">Limits of Computation</a></li>
<li><a href="/note/1072/intro-to-formal-language/8-computational-complexity">Computational Complexity</a></li>
</ul>
</li>
<li><a href="/note/1072/computer-organization/0-courseinfo">計算機組織</a>
<ul>
<li><a href="/note/1072/computer-organization/1-computer-abstractions">Computer Abstractions and Technology</a></li>
<li><a href="/note/1072/computer-organization/2-instructions">Instructions: Language of the Computer</a></li>
<li><a href="/note/1072/computer-organization/3-arithmetic">Arithmetic for Computers</a></li>
<li><a href="/note/1072/computer-organization/4-the-processor">The Processor</a></li>
<li><a href="/note/1072/computer-organization/5-exploiting-memory-hierarchy">Exploiting Memory Hierarchy</a></li>
</ul>
</li>
<li><a href="/note/1072/signals-and-systems/0-courseinfo">訊號與系統</a>
<ul>
<li><a href="/note/1072/signals-and-systems/1-fourier-representation">傅立葉表示法</a></li>
<li><a href="/note/1072/signals-and-systems/2-fourier-representation-properties">傅立葉表示法的性質</a></li>
<li><a href="/note/1072/signals-and-systems/3-fourier-representation-with-mixed-signals">傅立葉表示法對混合信號的應用</a></li>
</ul>
</li>
<li><a href="/note/1072/intro-to-music-theory/0-courseinfo">音樂理論導論</a>
<ul>
<li><a href="/note/1072/intro-to-music-theory/1-note">筆記</a></li>
</ul>
</li>
<li><a href="/note/1072/compiler-design/0-courseinfo">編譯器設計</a>
<ul>
<li><a href="/note/1072/compiler-design/1-introduction">Introduction</a></li>
<li><a href="/note/1072/compiler-design/2-lexical-analysis">Lexical Analysis</a></li>
<li><a href="/note/1072/compiler-design/3-syntax-analysis">Syntax Analysis</a></li>
<li><a href="/note/1072/compiler-design/4-syntax-directed-translation">Syntax-Directed Translation</a></li>
<li><a href="/note/1072/compiler-design/5-ir">Intermediate-Code Generation</a></li>
<li><a href="/note/1072/compiler-design/6-run-time-environments">Run-Time Environments</a></li>
<li><a href="/note/1072/compiler-design/7-code-generation">Code Generation</a></li>
<li><a href="/note/1072/compiler-design/8-control-flow">Control Flow</a></li>
<li><a href="/note/1072/compiler-design/9-dataflow">Data-Flow Analysis</a></li>
</ul>
</li>
</ul>
</li>
<li>大三</li>
<li>大四</li>
</ul>

  </div>
</div>

<script src="/note/js/book-sidebar.js"></script>
      </div>

      <div class="column col-8 col-lg-12">
        <div class="book-content">
          <div class="book-navbar">
  <header class="navbar">
  <section class="navbar-section">
    <img class="navbar-icon" src="/note/shell.png">
  </section>
  <section class="navbar-center">
    kaiiiz/note
  </section>
  <section class="navbar-section">
    <label class="accordion-header c-hand" for="accordion-sidebar">
      <i class="icon icon-menu"></i>
    </label>
  </section>
</header>

<div class="accordion">
  <input type="checkbox" id="accordion-sidebar" name="accordion-checkbox" hidden>
  <div class="accordion-body">
    <ul>
<li><a href="/note">首頁</a></li>
<li><a href="/note/1072/sophomore">大二</a>
<ul>
<li><a href="/note/1072/intro-to-formal-language/0-courseinfo">正規語言概論</a>
<ul>
<li><a href="/note/1072/intro-to-formal-language/1-finite-automata">Finite Automata</a></li>
<li><a href="/note/1072/intro-to-formal-language/2-regular-languages">Regular Languages</a></li>
<li><a href="/note/1072/intro-to-formal-language/3-context-free-languages">Context-Free Languages</a></li>
<li><a href="/note/1072/intro-to-formal-language/4-pushdown-automata">Pushdown Automata</a></li>
<li><a href="/note/1072/intro-to-formal-language/5-turing-machines">Turing Machines</a></li>
<li><a href="/note/1072/intro-to-formal-language/6-hierarchy-of-formal-languages">Hierarchy of Formal Languages</a></li>
<li><a href="/note/1072/intro-to-formal-language/7-limits-of-computation">Limits of Computation</a></li>
<li><a href="/note/1072/intro-to-formal-language/8-computational-complexity">Computational Complexity</a></li>
</ul>
</li>
<li><a href="/note/1072/computer-organization/0-courseinfo">計算機組織</a>
<ul>
<li><a href="/note/1072/computer-organization/1-computer-abstractions">Computer Abstractions and Technology</a></li>
<li><a href="/note/1072/computer-organization/2-instructions">Instructions: Language of the Computer</a></li>
<li><a href="/note/1072/computer-organization/3-arithmetic">Arithmetic for Computers</a></li>
<li><a href="/note/1072/computer-organization/4-the-processor">The Processor</a></li>
<li><a href="/note/1072/computer-organization/5-exploiting-memory-hierarchy">Exploiting Memory Hierarchy</a></li>
</ul>
</li>
<li><a href="/note/1072/signals-and-systems/0-courseinfo">訊號與系統</a>
<ul>
<li><a href="/note/1072/signals-and-systems/1-fourier-representation">傅立葉表示法</a></li>
<li><a href="/note/1072/signals-and-systems/2-fourier-representation-properties">傅立葉表示法的性質</a></li>
<li><a href="/note/1072/signals-and-systems/3-fourier-representation-with-mixed-signals">傅立葉表示法對混合信號的應用</a></li>
</ul>
</li>
<li><a href="/note/1072/intro-to-music-theory/0-courseinfo">音樂理論導論</a>
<ul>
<li><a href="/note/1072/intro-to-music-theory/1-note">筆記</a></li>
</ul>
</li>
<li><a href="/note/1072/compiler-design/0-courseinfo">編譯器設計</a>
<ul>
<li><a href="/note/1072/compiler-design/1-introduction">Introduction</a></li>
<li><a href="/note/1072/compiler-design/2-lexical-analysis">Lexical Analysis</a></li>
<li><a href="/note/1072/compiler-design/3-syntax-analysis">Syntax Analysis</a></li>
<li><a href="/note/1072/compiler-design/4-syntax-directed-translation">Syntax-Directed Translation</a></li>
<li><a href="/note/1072/compiler-design/5-ir">Intermediate-Code Generation</a></li>
<li><a href="/note/1072/compiler-design/6-run-time-environments">Run-Time Environments</a></li>
<li><a href="/note/1072/compiler-design/7-code-generation">Code Generation</a></li>
<li><a href="/note/1072/compiler-design/8-control-flow">Control Flow</a></li>
<li><a href="/note/1072/compiler-design/9-dataflow">Data-Flow Analysis</a></li>
</ul>
</li>
</ul>
</li>
<li>大三</li>
<li>大四</li>
</ul>

  </div>
</div>
</div>

<div class="book-post">
  <h1 id="exploiting-memory-hierarchy">Exploiting Memory Hierarchy</h1>
<h2 id="memory-technology">Memory Technology</h2>
<ul>
<li>Static RAM (SRAM)
<ul>
<li>0.5ns –2.5ns, $2000 –$5000 per GB</li>
</ul>
</li>
<li>Dynamic RAM (DRAM)
<ul>
<li>50ns –70ns, $20 –$75 per GB</li>
</ul>
</li>
<li>Magnetic disk
<ul>
<li>5ms –20ms, $0.20 –$2 per GB</li>
</ul>
</li>
<li>Ideal memory
<ul>
<li>Access time of SRAM</li>
<li>Capacity and cost/GB of disk</li>
</ul>
</li>
</ul>
<h2 id="principle-of-locality">Principle of Locality</h2>
<p>Temporal locality: 最近剛存取的資源會在短時間內再存取一次 (e.g. Loop, induction variables)<br>
Spatial locality: 靠近最近剛存取的資源會在短時間內被存取 (e.g. array)</p>
<p>利用現實的限制達到理想的目標: memory hierarchy</p>
<p>disk -&gt; DRAM -&gt; SRAM</p>
<p>讀一個 word 讀不到。到 DRAM 取 256 個 word 到 cache 內</p>
<p>將最近要被使用的資源(以及附近的資源)從 disk 複製到 DRAM<br>
複製更常用的資源從 DRAM 到 SRAM</p>
<h2 id="memory-hierarchy-levels">Memory Hierarchy Levels</h2>
<p><img src="2019-06-05-11-05-52.png" alt="Block (aka line): unit of copying"></p>
<p>如果在最上層的 cache 有資料: hit</p>
<p>如果沒有: miss，從下層複製上去 (need miss penalty)</p>
<h2 id="cache-memory">Cache Memory</h2>
<p>最接近 CPU</p>
<h3 id="direct-mapped-cache">Direct Mapped Cache</h3>
<p>1 個 cache mapping 到多個 memory</p>
<p>(Block address) % (#Blocks in cache)</p>
<p><img src="2019-06-05-11-20-21.png" alt></p>
<ul>
<li>tag: 來自哪個 memory
<ul>
<li>Store block address (only high-order bits)</li>
</ul>
</li>
<li>valid bit: 1/0 區分是否有 data</li>
<li>index: cache 的哪個位置</li>
<li>offset:
<ul>
<li>byte offset: default 2bit</li>
<li>word offset: 這個 block 的第幾個 word</li>
</ul>
</li>
</ul>
<h4 id="example">Example</h4>
<p>8-blocks, 1 word/block, direct mapped</p>
<p><img src="2019-06-05-11-27-57.png" alt="initial state"></p>
<p><img src="2019-06-05-11-28-38.png" alt="access 110: miss"></p>
<p><img src="2019-06-05-11-30-12.png" alt="access 010: miss"></p>
<p><img src="2019-06-05-11-30-50.png" alt="access 110 &amp;gt; 010"></p>
<p><img src="2019-06-05-11-31-17.png" alt="access 000 &amp;gt; 011 &amp;gt; 000"></p>
<p><img src="2019-06-05-11-31-50.png" alt="access 010: overwrite"></p>
<h3 id="address-subdivision">Address Subdivision</h3>
<p><img src="2019-06-05-11-36-18.png" alt></p>
<p>總 bits 數計算:</p>
<p>cache size: <span class="katex"><span class="katex-mathml"><math><semantics><mrow><msup><mn>2</mn><mi>n</mi></msup></mrow><annotation encoding="application/x-tex">2^n</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.664392em;vertical-align:0em;"></span><span class="mord"><span class="mord">2</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.664392em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">n</span></span></span></span></span></span></span></span></span></span></span> blocks<br>
block data size: <span class="katex"><span class="katex-mathml"><math><semantics><mrow><msup><mn>2</mn><mi>m</mi></msup></mrow><annotation encoding="application/x-tex">2^m</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.664392em;vertical-align:0em;"></span><span class="mord"><span class="mord">2</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.664392em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">m</span></span></span></span></span></span></span></span></span></span></span> words<br>
block tag size: <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mn>32</mn><mo>−</mo><mo>(</mo><mi>n</mi><mo>+</mo><mi>m</mi><mo>+</mo><mn>2</mn><mo>)</mo></mrow><annotation encoding="application/x-tex">32 - (n + m + 2)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.72777em;vertical-align:-0.08333em;"></span><span class="mord">3</span><span class="mord">2</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">(</span><span class="mord mathdefault">n</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.66666em;vertical-align:-0.08333em;"></span><span class="mord mathdefault">m</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord">2</span><span class="mclose">)</span></span></span></span> (<span class="katex"><span class="katex-mathml"><math><semantics><mrow><msup><mn>2</mn><mi>m</mi></msup></mrow><annotation encoding="application/x-tex">2^m</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.664392em;vertical-align:0em;"></span><span class="mord"><span class="mord">2</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.664392em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">m</span></span></span></span></span></span></span></span></span></span></span> words = <span class="katex"><span class="katex-mathml"><math><semantics><mrow><msup><mn>2</mn><mrow><mi>m</mi><mo>+</mo><mn>2</mn></mrow></msup></mrow><annotation encoding="application/x-tex">2^{m+2}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8141079999999999em;vertical-align:0em;"></span><span class="mord"><span class="mord">2</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8141079999999999em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">m</span><span class="mbin mtight">+</span><span class="mord mtight">2</span></span></span></span></span></span></span></span></span></span></span></span> bytes)<br>
total number of bits: <span class="katex"><span class="katex-mathml"><math><semantics><mrow><msup><mn>2</mn><mi>n</mi></msup><mo>×</mo><mo>(</mo><msup><mn>2</mn><mi>m</mi></msup><mo>×</mo><mn>32</mn><mo>+</mo><mo>(</mo><mn>32</mn><mo>−</mo><mi>n</mi><mo>−</mo><mi>m</mi><mo>−</mo><mn>2</mn><mo>)</mo><mo>+</mo><mn>1</mn><mo>)</mo></mrow><annotation encoding="application/x-tex">2^n \times ( 2^m \times 32 + ( 32 - n - m - 2) + 1)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.747722em;vertical-align:-0.08333em;"></span><span class="mord"><span class="mord">2</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.664392em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">n</span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">×</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">(</span><span class="mord"><span class="mord">2</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.664392em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">m</span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">×</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.72777em;vertical-align:-0.08333em;"></span><span class="mord">3</span><span class="mord">2</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">(</span><span class="mord">3</span><span class="mord">2</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.66666em;vertical-align:-0.08333em;"></span><span class="mord mathdefault">n</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.66666em;vertical-align:-0.08333em;"></span><span class="mord mathdefault">m</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord">2</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord">1</span><span class="mclose">)</span></span></span></span></p>
<p>for example: 16KB data, 4-word blocks, assume a 32-bit address</p>
<p><span class="katex"><span class="katex-mathml"><math><semantics><mrow><msup><mn>2</mn><mn>10</mn></msup><mo>×</mo><mo>(</mo><mn>4</mn><mo>×</mo><mn>32</mn><mo>+</mo><mo>(</mo><mn>32</mn><mo>−</mo><mn>10</mn><mo>−</mo><mn>2</mn><mo>−</mo><mn>2</mn><mo>)</mo><mo>+</mo><mn>1</mn><mo>)</mo><mo>=</mo><msup><mn>2</mn><mn>10</mn></msup><mo>×</mo><mn>147</mn><mo>=</mo><mn>147</mn><mi>K</mi><mi>b</mi><mi>i</mi><mi>t</mi><mi>s</mi></mrow><annotation encoding="application/x-tex">2^{10} \times (4 \times 32 + ( 32 - 10 - 2 - 2 ) + 1) = 2^{10} \times 147 = 147 Kbits</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.897438em;vertical-align:-0.08333em;"></span><span class="mord"><span class="mord">2</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8141079999999999em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">1</span><span class="mord mtight">0</span></span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">×</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">(</span><span class="mord">4</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">×</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.72777em;vertical-align:-0.08333em;"></span><span class="mord">3</span><span class="mord">2</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">(</span><span class="mord">3</span><span class="mord">2</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.72777em;vertical-align:-0.08333em;"></span><span class="mord">1</span><span class="mord">0</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.72777em;vertical-align:-0.08333em;"></span><span class="mord">2</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord">2</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord">1</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.897438em;vertical-align:-0.08333em;"></span><span class="mord"><span class="mord">2</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8141079999999999em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">1</span><span class="mord mtight">0</span></span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">×</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.64444em;vertical-align:0em;"></span><span class="mord">1</span><span class="mord">4</span><span class="mord">7</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.69444em;vertical-align:0em;"></span><span class="mord">1</span><span class="mord">4</span><span class="mord">7</span><span class="mord mathdefault" style="margin-right:0.07153em;">K</span><span class="mord mathdefault">b</span><span class="mord mathdefault">i</span><span class="mord mathdefault">t</span><span class="mord mathdefault">s</span></span></span></span></p>
<p><img src="2019-06-05-11-51-41.png" alt="取出 index 的方法"></p>
<h3 id="block-size">Block Size?</h3>
<ul>
<li>大的 blocks 可以減少 miss rate (spatial locality)</li>
<li>在相同的 cache size 中
<ul>
<li>大的 block 會使 block 數量減少，增加 competition，提高 miss rate</li>
<li>大的 block，占 cache 空間但沒有人 access，造成浪費</li>
</ul>
</li>
</ul>
<p>e.g.</p>
<p>128 x 128 access 16 x 16</p>
<p>8 larger blocks vs 16 smaller blocks</p>
<p>16 快: 因為 16 block 紀錄所有 16 個 array，第一次 miss，後面所有都 hit<br>
8 慢: 多 load 在 window 外面的東西，但是不會用 &gt; pollution</p>
<h3 id="cache-misses">Cache Misses</h3>
<p><a href="http://dannynote.blogspot.com/2007/04/cachereadwrite-throughbackallocate.html" target="_blank" rel="noopener">有關Cache的read/write through/back/allocate的意義</a></p>
<p>Cache hits:</p>
<ul>
<li>直接從 CPU 讀資料</li>
</ul>
<p>Cache Misses:</p>
<ul>
<li>Stall the CPU pipeline</li>
<li>Read-Through
<ul>
<li>直接從 main memory 讀到 CPU</li>
</ul>
</li>
<li>No Read-Through
<ul>
<li>從 main memory 讀到 cache 再讀到 CPU</li>
</ul>
</li>
<li>Instruction cache miss
<ul>
<li>Restart instruction fetch</li>
</ul>
</li>
<li>Data cache miss
<ul>
<li>Complete data access</li>
</ul>
</li>
</ul>
<p>Write hits:</p>
<ul>
<li>Write-Through
<ul>
<li>每次的 cache 寫完不會直接結束，會再寫到 memory &gt; for consistent (但很慢)</li>
<li><mark>Solution: write buffer</mark></li>
</ul>
</li>
<li>Write-Back
<ul>
<li>只 update cache，持續觀察 cache，當被 update 的 cache 要被 replace 時再寫回 memory</li>
</ul>
</li>
</ul>
<p>Write miss:</p>
<ul>
<li>Write-Through
<ul>
<li>直接寫 memory (don’t fetch the block)</li>
</ul>
</li>
<li>Write-Back
<ul>
<li>fetch the block into cache</li>
</ul>
</li>
</ul>
<h3 id="main-memory-supporting-caches">Main Memory Supporting Caches</h3>
<ul>
<li>Use DRAMs for main memory, connected by fixed-width clocked bus</li>
</ul>
<p>Miss penalty for 4-word block, 1-word-wide DRAM</p>
<p>address transfer (1) + word (4) x per DRAM access (15) + per data transfer (1) = 65 bus cycles</p>
<p>Bandwidth = 16 bytes / 65 cycles = 0.25 B/cycle</p>
<h3 id="increasing-memory-bandwidth">Increasing Memory Bandwidth</h3>
<p><img src="2019-06-05-12-28-56.png" alt></p>
<ul>
<li>4-word wide memory
<ul>
<li>Miss penalty = 1 + 15 + 1 = 17 bus cycles</li>
<li>Bandwidth = 16 bytes / 17 cycles = 0.94 B/cycle</li>
</ul>
</li>
<li>4-bank interleaved memory
<ul>
<li>Miss penalty = 1 + 15 + 4 (送四次) ×1 = 20 bus cycles</li>
<li>Bandwidth = 16 bytes / 20 cycles = 0.8 B/cycle</li>
</ul>
</li>
</ul>
<h3 id="advanced-dram-organization">Advanced DRAM Organization</h3>
<ul>
<li>Bits in a DRAM are organized as a rectangular array: DRAM accesses an entire row</li>
<li>Double data rate (DDR) DRAM</li>
<li>Quad data rate (QDR) DRAM</li>
</ul>
<h2 id="cache-performance">Cache Performance</h2>
<ul>
<li>Components of CPU time
<ul>
<li>Program execution cycles (include cache hit)</li>
<li>Memory stall cycles (mainly cache misses)</li>
</ul>
</li>
</ul>
<p class="katex-block"><span class="katex-display"><span class="katex"><span class="katex-mathml"><math><semantics><mtable><mtr><mtd><mstyle scriptlevel="0" displaystyle="true"><mtext>Memory stall cycles</mtext></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="true"><mrow><mrow></mrow><mo>=</mo><mfrac><mtext>Memory accesses</mtext><mtext>Program</mtext></mfrac><mo>×</mo><mtext>Miss rate</mtext><mo>×</mo><mtext>Miss penalty</mtext></mrow></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="true"><mrow></mrow></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="true"><mrow><mrow></mrow><mo>=</mo><mfrac><mtext>Instructions</mtext><mtext>Program</mtext></mfrac><mo>×</mo><mfrac><mtext>Misses</mtext><mtext>Instruction</mtext></mfrac><mo>×</mo><mtext>Miss penalty</mtext></mrow></mstyle></mtd></mtr></mtable><annotation encoding="application/x-tex">\begin{aligned}
    \text{Memory stall cycles} &amp;= \frac{\text{Memory accesses}}{\text{Program}} \times \text{Miss rate} \times \text{Miss penalty} \\
    &amp;= \frac{\text{Instructions}}{\text{Program}} \times \frac{\text{Misses}}{\text{Instruction}} \times \text{Miss penalty}
\end{aligned}
</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:5.08154em;vertical-align:-2.29077em;"></span><span class="mord"><span class="mtable"><span class="col-align-r"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:2.79077em;"><span style="top:-4.79077em;"><span class="pstrut" style="height:3.3603300000000003em;"></span><span class="mord"><span class="mord text"><span class="mord">Memory stall cycles</span></span></span></span><span style="top:-2.25em;"><span class="pstrut" style="height:3.3603300000000003em;"></span><span class="mord"></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:2.29077em;"><span></span></span></span></span></span><span class="col-align-l"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:2.79077em;"><span style="top:-4.79077em;"><span class="pstrut" style="height:3.3603300000000003em;"></span><span class="mord"><span class="mord"></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.3603299999999998em;"><span style="top:-2.314em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord text"><span class="mord">Program</span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord text"><span class="mord">Memory accesses</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.8804400000000001em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">×</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mord text"><span class="mord">Miss rate</span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">×</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mord text"><span class="mord">Miss penalty</span></span></span></span><span style="top:-2.25em;"><span class="pstrut" style="height:3.3603300000000003em;"></span><span class="mord"><span class="mord"></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.36033em;"><span style="top:-2.314em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord text"><span class="mord">Program</span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord text"><span class="mord">Instructions</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.8804400000000001em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">×</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.36033em;"><span style="top:-2.314em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord text"><span class="mord">Instruction</span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord text"><span class="mord">Misses</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.686em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">×</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mord text"><span class="mord">Miss penalty</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:2.29077em;"><span></span></span></span></span></span></span></span></span></span></span></span></p>
<p>e.g.</p>
<p>Given</p>
<ul>
<li>I-cache miss rate = 2%</li>
<li>D-cache miss rate = 4%</li>
<li>Miss penalty = 100 cycles</li>
<li>Base CPI (ideal cache) = 2</li>
<li>Load &amp; stores are 36% of instructions</li>
</ul>
<p>Miss cycles per instruction</p>
<ul>
<li>I-cache: 0.02 × 100 = 2</li>
<li>D-cache: 0.36 × 0.04 ×100 = 1.44</li>
</ul>
<p>Actual CPI = 2 + 2 + 1.44 = 5.44</p>
<blockquote>
<p>i-cache: branch / not-branch 兩種情況，miss rate 較少</p>
</blockquote>
<h3 id="average-access-time">Average Access Time</h3>
<p>Average memory access time (AMAT)</p>
<p class="katex-block"><span class="katex-display"><span class="katex"><span class="katex-mathml"><math><semantics><mrow><mtext>AMAT</mtext><mo>=</mo><mtext>Hit time</mtext><mo>+</mo><mtext>Miss rate</mtext><mo>×</mo><mtext>Miss penalty</mtext></mrow><annotation encoding="application/x-tex">\text{AMAT} = \text{Hit time} + \text{Miss rate} \times \text{Miss penalty} 
</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.68333em;vertical-align:0em;"></span><span class="mord text"><span class="mord">AMAT</span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.76666em;vertical-align:-0.08333em;"></span><span class="mord text"><span class="mord">Hit time</span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.76666em;vertical-align:-0.08333em;"></span><span class="mord text"><span class="mord">Miss rate</span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">×</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.8888799999999999em;vertical-align:-0.19444em;"></span><span class="mord text"><span class="mord">Miss penalty</span></span></span></span></span></span></p>
<p>e.g.</p>
<ul>
<li>CPU with 1ns clock</li>
<li>hit time = 1 cycle</li>
<li>miss penalty = 20 cycles</li>
<li>cache miss rate = 5%</li>
</ul>
<p>AMAT = 1 + 0.05 × 20 = 2 ns</p>
<h3 id="summary">Summary</h3>
<ul>
<li>CPU performance increased &gt; Miss penalty becomes more significant</li>
<li>Decreasing base CPI &gt; Greater proportion of time spent on memory stalls</li>
<li>Increasing clock rate &gt; Memory stalls account for more CPU cycles</li>
</ul>
<h2 id="associative-caches">Associative Caches</h2>
<ul>
<li>fully associative
<ul>
<li>memory 要搬到 cache 沒有限制，有空的就可以搬進去 (可以放到 cache 的任意位置)</li>
<li>對每個 entry 都需要 comparator (貴)</li>
</ul>
</li>
<li>n-way set associative
<ul>
<li>分為多個 set，每個 set 包含 n 個 entries</li>
<li>block address 有一個欄位對應到 cache 的 set address ((Block number) modulo (#Sets in cache))</li>
<li>n 個 comparator (要知道 block 在 set 的哪裡)</li>
</ul>
</li>
<li>direct
<ul>
<li>1-way set</li>
</ul>
</li>
</ul>
<p><img src="2019-06-05-13-57-39.png" alt></p>
<h3 id="example-v2">Example</h3>
<p>For a cache with 8 entries</p>
<p><img src="2019-06-05-13-58-57.png" alt></p>
<p>Block access sequence: 0, 8, 0, 6, 8</p>
<p><img src="2019-06-05-14-07-13.png" alt="Direct mapped"></p>
<p><img src="2019-06-05-14-07-31.png" alt="2-way set associative"></p>
<p><img src="2019-06-05-14-07-56.png" alt="Fully associative"></p>
<h3 id="how-much">How Much?</h3>
<p>associativity 上升，miss rate 下降，但效果會逐漸下降</p>
<p>e.g. Simulation of a system with 64KBD-cache, 16-word blocks, SPEC2000</p>
<ul>
<li>1-way: 10.3%</li>
<li>2-way: 8.6%</li>
<li>4-way: 8.3%</li>
<li>8-way: 8.1%</li>
</ul>
<h3 id="organization">Organization</h3>
<p><img src="2019-06-05-14-19-06.png" alt></p>
<p><img src="2019-06-05-14-21-50.png" alt="4-1 Multiplexer"></p>
<h3 id="replacement-policy">Replacement Policy</h3>
<ul>
<li>Direct mapped
<ul>
<li>no choice</li>
</ul>
</li>
<li>Set associative
<ul>
<li>non-valid 優先被 replace</li>
</ul>
</li>
<li>Least-recently used (LRU)
<ul>
<li>最近被 access 到的留下來</li>
<li>Simple for 2-way, manageable for 4-way, too hard beyond that</li>
</ul>
</li>
<li>Random</li>
</ul>
<h2 id="multilevel-caches">Multilevel Caches</h2>
<ul>
<li>Primary cache attached to CPU
<ul>
<li>Small, but fast</li>
</ul>
</li>
<li>Level-2 cache services misses from primary cache
<ul>
<li>Larger, slower, but still faster than main memory</li>
</ul>
</li>
<li>Main memory services L-2 cache misses</li>
<li>Some high-end systems include L-3 cache</li>
</ul>
<h3 id="example-v3">Example</h3>
<p>Given</p>
<ul>
<li>CPU base CPI = 1, clock rate = 4GHz</li>
<li>Miss rate/instruction = 2%</li>
<li>Main memory access time = 100ns</li>
</ul>
<p>just primary cache:</p>
<ul>
<li>Miss penalty = 100ns / 0.25ns = 400 cycles</li>
<li>Effective CPI = 1 + 0.02 × 400 = 9</li>
</ul>
<p>with L-2 cache:</p>
<ul>
<li>Access time = 5ns</li>
<li>Global miss rate to main memory = 0.5%</li>
<li>Primary miss with L-2 hit &gt; Penalty = 5ns / 0.25ns = 20 cycles</li>
<li>Primary miss with L-2 miss &gt; Extra penalty = 400 cycles</li>
<li>CPI = 1 + 0.02 × 20 + 0.005 × 400 = 3.4</li>
</ul>
<h3 id="considerations">Considerations</h3>
<p>primary cache: hit time (cache較小)<br>
L-2 cache: miss rate (avoid main memory access) (cache較大)</p>
<blockquote>
<p>L-1 cache size &lt; single cache size<br>
L-1 block size &lt; L-2 block size</p>
</blockquote>
<h2 id="interactions-with-advanced-cpus">Interactions with Advanced CPUs</h2>
<p>Out-of-order CPUs can execute instructions during cache miss</p>
<ul>
<li>Pending store stays in load/store unit</li>
<li>Dependent instructions wait in reservation stations</li>
<li><strong>Independent instructions continue</strong></li>
</ul>
<p>Effect of miss depends on program data flow</p>
<h2 id="interactions-with-software">Interactions with Software</h2>
<p>Misses depend on memory access patterns</p>
<ul>
<li>Algorithm behavior</li>
<li>Compiler optimization for memory access</li>
</ul>
<p><img src="2019-06-05-14-49-05.png" alt></p>
<h2 id="software-optimization-via-blocking">Software Optimization via Blocking</h2>
<p>Goal: maximize accesses to data before it is replaced</p>
<p>把一直換 index 的一次加一個 block size，inblock miss 伴隨一堆 hit</p>
<p><img src="2019-06-05-15-09-38.png" alt></p>
<h2 id="dependability">Dependability</h2>
<p><img src="2019-06-05-15-11-15.png" alt></p>
<h3 id="measures">Measures</h3>
<p><img src="2019-06-05-15-13-37.png" alt></p>
<p>Reliability: <mark>mean time to failure</mark> (MTTF)<br>
Service interruption: <mark>mean time to repair</mark> (MTTR)<br>
Mean time between failures: MTBF = MTTF + MTTR<br>
Availability = MTTF / (MTTF + MTTR)</p>
<p>Improving Availability:</p>
<ul>
<li>Increase MTTF: fault avoidance, fault tolerance, fault forecasting</li>
<li>Reduce MTTR: improved tools and processes for diagnosis and repair</li>
</ul>
<h3 id="the-hamming-sec-code">The Hamming SEC Code</h3>
<p>Hamming distance: 兩個字符串對應位置的不同字符的個數</p>
<p>e.g. 10<mark>1</mark>1<mark>1</mark>01 與 10<mark>0</mark>1<mark>0</mark>01 之間的 Hamming distance 是2。</p>
<p><a href="http://dangerlover9403.pixnet.net/blog/post/202441998-%5B%E6%95%99%E5%AD%B8%5D-%E6%BC%A2%E6%98%8E%E6%B3%95-(-hamming-code-)" target="_blank" rel="noopener">[教學] 漢明法 ( Hamming code )</a></p>
<h4 id="sec-ded-code">SEC/DED Code</h4>
<p>Add an additional parity bit for the whole word (<span class="katex"><span class="katex-mathml"><math><semantics><mrow><msub><mi>p</mi><mi>n</mi></msub></mrow><annotation encoding="application/x-tex">p_n</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.625em;vertical-align:-0.19444em;"></span><span class="mord"><span class="mord mathdefault">p</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.151392em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">n</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span>)</p>
<p>Make Hamming distance = 4</p>
<p>Let H = SEC parity bits</p>
<ul>
<li><span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>H</mi></mrow><annotation encoding="application/x-tex">H</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.68333em;vertical-align:0em;"></span><span class="mord mathdefault" style="margin-right:0.08125em;">H</span></span></span></span> even, <span class="katex"><span class="katex-mathml"><math><semantics><mrow><msub><mi>p</mi><mi>n</mi></msub></mrow><annotation encoding="application/x-tex">p_n</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.625em;vertical-align:-0.19444em;"></span><span class="mord"><span class="mord mathdefault">p</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.151392em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">n</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span> even, no error</li>
<li><span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>H</mi></mrow><annotation encoding="application/x-tex">H</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.68333em;vertical-align:0em;"></span><span class="mord mathdefault" style="margin-right:0.08125em;">H</span></span></span></span> odd, <span class="katex"><span class="katex-mathml"><math><semantics><mrow><msub><mi>p</mi><mi>n</mi></msub></mrow><annotation encoding="application/x-tex">p_n</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.625em;vertical-align:-0.19444em;"></span><span class="mord"><span class="mord mathdefault">p</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.151392em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">n</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span> odd, correctable single bit error</li>
<li><span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>H</mi></mrow><annotation encoding="application/x-tex">H</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.68333em;vertical-align:0em;"></span><span class="mord mathdefault" style="margin-right:0.08125em;">H</span></span></span></span> even, <span class="katex"><span class="katex-mathml"><math><semantics><mrow><msub><mi>p</mi><mi>n</mi></msub></mrow><annotation encoding="application/x-tex">p_n</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.625em;vertical-align:-0.19444em;"></span><span class="mord"><span class="mord mathdefault">p</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.151392em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">n</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span> odd, error in pnbit</li>
<li><span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>H</mi></mrow><annotation encoding="application/x-tex">H</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.68333em;vertical-align:0em;"></span><span class="mord mathdefault" style="margin-right:0.08125em;">H</span></span></span></span> odd, <span class="katex"><span class="katex-mathml"><math><semantics><mrow><msub><mi>p</mi><mi>n</mi></msub></mrow><annotation encoding="application/x-tex">p_n</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.625em;vertical-align:-0.19444em;"></span><span class="mord"><span class="mord mathdefault">p</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.151392em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">n</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span> even, double error occurred</li>
</ul>
<h2 id="virtual-memory">Virtual Memory</h2>
<p><strong>Use main memory as a “cache” for secondary (disk) storage</strong></p>
<ul>
<li>Program share main memory
<ul>
<li>每個 program 會拿到 private virtual address space</li>
</ul>
</li>
<li>CPU and OS translate virtual addresses to physical addresses
<ul>
<li>VM “block” is called a <strong>page</strong></li>
<li>VM translation “miss” is called a <strong>page fault</strong></li>
</ul>
</li>
</ul>
<p><img src="2019-06-05-20-56-21.png" alt></p>
<h3 id="page-fault-penalty">Page Fault Penalty</h3>
<p>page fault &gt; page fetched from disk (超慢)</p>
<p>solution:</p>
<ul>
<li>Fully associative placement</li>
<li>Smart replacement algorithms</li>
</ul>
<h3 id="page-tables">Page Tables</h3>
<p>Stores placement information</p>
<ul>
<li>Array of page table entries</li>
<li>indexed: virtual page number</li>
<li>在 CPU 的 page table register 會指向在 physical memory 的 page table</li>
</ul>
<p>If page is present in memory</p>
<ul>
<li>PTE stores the physical page number</li>
<li>Plus other status bits</li>
</ul>
<p>If page is not present</p>
<ul>
<li>PTE can refer to location in swap space on disk</li>
</ul>
<h3 id="translation-using-a-page-table">Translation Using a Page Table</h3>
<p><img src="2019-06-05-21-03-36.png" alt></p>
<h3 id="mapping-pages-to-storage">Mapping Pages to Storage</h3>
<p><img src="2019-06-05-21-05-33.png" alt></p>
<h3 id="replacement-and-writes">Replacement and Writes</h3>
<ul>
<li>To reduce page fault rate, prefer least-recently used (LRU) replacement
<ul>
<li>當 access page 時 Reference bit (aka use bit) 設為 1</li>
<li>OS 會定時清理為 0</li>
<li>use bit 為 0 的為不常用的</li>
</ul>
</li>
<li>Disk writes take millions of cycles!
<ul>
<li>Block at once, not individual locations</li>
<li>Write through is impractical</li>
<li>Use write-back</li>
<li>Dirty bit in PTE set when page is written</li>
</ul>
</li>
</ul>

</div>


  <div class="book-comments">
    
    <div id="disqus_thread"></div>
    <script>
    (function() { // DON'T EDIT BELOW THIS LINE
    var d = document, s = d.createElement('script');
    s.src = 'https://at881005.disqus.com/embed.js';
    s.setAttribute('data-timestamp', +new Date());
    (d.head || d.body).appendChild(s);
    })();
    </script>
    <noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>



  </div>


<script src="/note/js/book-post.js"></script>
        </div>
      </div>

      <div class="column col-2 hide-lg">
        <div class="book-toc">
  <div class="book-tocbot">
  </div>
  <div class="book-tocbot-menu">
    <a class="book-toc-expand" onclick="expand_toc()">Expand all</a>
    <a onclick="go_top()">Back to top</a>
    <a onclick="go_bottom()">Go to bottom</a>
  </div>
</div>

<script>
tocbot.init({
  tocSelector: '.book-tocbot',
  contentSelector: '.book-post',
  headingSelector: 'h1, h2, h3, h4, h5',
  collapseDepth: 2,
  orderedList: false,
  scrollSmooth: false,
});

function expand_toc(){
  var b = document.querySelector(".book-toc-expand");
  tocbot.init({
    tocSelector: '.book-tocbot',
    contentSelector: '.book-post',
    headingSelector: 'h1, h2, h3, h4, h5',
    collapseDepth: 6,
    orderedList: false,
    scrollSmooth: false,
  });
  b.setAttribute("onclick", "collapse_toc()");
  b.innerHTML = "Collapse all"
}

function collapse_toc(){
  var b = document.querySelector(".book-toc-expand");
  tocbot.init({
    tocSelector: '.book-tocbot',
    contentSelector: '.book-post',
    headingSelector: 'h1, h2, h3, h4, h5',
    collapseDepth: 2,
    orderedList: false,
    scrollSmooth: false,
  });
  b.setAttribute("onclick", "expand_toc()");
  b.innerHTML = "Expand all"
}

function go_top() {
  window.scrollTo(0, 0);
}

function go_bottom() {
  window.scrollTo(0, document.body.scrollHeight);
}

</script>
      </div>
    </div>
  </div>
</div>

</body>
</html>
